<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>DebugService</title>
</head>

<body>
	<h1>DebugService</h1>
	<ul>
		<li>行き先パス: <input id="path" type="text" value="">
		<li>送るファイルを選択: <input type="file" id="file">
		<li><input id="upload" type="button" value="アップロード">
		<li><input id="delete" type="button" value="実機から削除">
		<li><input id="delete-all" type="button" value="実機から全ファイル削除">
	</ul>
	<output id="log">
	<script>
		var ipAddress = '__TO_BE_REPLACED_WITH_ACTUAL_IP_ADDRESS_IN_RUNTIME__'
		var log = document.getElementById('log');

		var onLoad = function (binaryString) {
			var path = document.getElementById('path').value;
			var request = new XMLHttpRequest();
			request.onload = function () {
				log.value = 'アップロード受理\n';
			};
			request.onerror = function () {
				log.value = 'アップロード失敗\n';
			};
			request.open('PUT', 'http://' + ipAddress + ':8080/upload-file', true);

			var arg = {};
			arg.path = path;
			arg.contentBase64 = window.btoa(binaryString);
			var argJson = JSON.stringify(arg);
			request.send(argJson);
		};
		var onUpload = function () {
			var files = document.getElementById('file').files;
			if (files.length == 0) {
				return;
			}
			var reader = new FileReader();
			reader.onload = function (e) {
				onLoad(e.target.result);
			};
			reader.readAsBinaryString(files[0]);
		};
		var onFileSelected = function () {
			var path = document.getElementById('path').value;
			if ((typeof path === 'undefined') || (path.length === 0)) {
				var files = document.getElementById('file').files;
				if (files.length > 0) {
					document.getElementById('path').value = files[0].name;
				}
			}
		};
		var onDelete = function (){
			var path = document.getElementById('path').value;
			var request = new XMLHttpRequest();
			request.onload = function () {
				log.value = '削除受理\n';
			};
			request.onerror = function () {
				log.value = '削除失敗\n';
			};
			request.open('PUT', 'http://' + ipAddress + ':8080/delete-file', true);

			var arg = {};
			arg.path = path;
			arg.contentBase64 = null;
			var argJson = JSON.stringify(arg);
			request.send(argJson);
		};
		var onDeleteAll = function (){
			var path = document.getElementById('path').value;
			var request = new XMLHttpRequest();
			request.onload = function () {
				log.value = '全削除受理\n';
			};
			request.onerror = function () {
				log.value = '全削除失敗\n';
			};
			request.open('PUT', 'http://' + ipAddress + ':8080/delete-all-file', true);
			request.send(null);
		};
		document.getElementById('upload').addEventListener('click', onUpload, false);
		document.getElementById('delete').addEventListener('click', onDelete, false);
		document.getElementById('delete-all').addEventListener('click', onDeleteAll, false);
		document.getElementById('file').addEventListener('input', onFileSelected, false)

	</script>
</body>

</html>